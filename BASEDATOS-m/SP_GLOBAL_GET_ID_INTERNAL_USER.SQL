USE FORO_EMPRENDE;
DELIMITER $$

-- DELETE THE PROCEDURE IF IT ALREADY EXISTS
DROP PROCEDURE IF EXISTS SP_GLOBAL_GET_ID_INTERNAL_USER $$

-- CREATE THE PROCEDURE
CREATE PROCEDURE SP_GLOBAL_GET_ID_INTERNAL_USER (
    IN P_EXTERNAL_ID VARCHAR(64), -- PARAMETER FOR THE EXTERNAL ID
    OUT P_INTERNAL_ID VARCHAR(64) -- OUTPUT PARAMETER FOR THE INTERNAL ID
)
BEGIN
    -- INITIALIZE THE INTERNAL ID TO 0 IN CASE THE USER IS NOT FOUND
    SET P_INTERNAL_ID = 0;

    -- SEARCH FOR THE USER WITH THE GIVEN EXTERNAL ID
    SELECT USE_INTERNAL_ID 
    INTO P_INTERNAL_ID
    FROM USERS
    WHERE USE_EXTERNAL_ID = P_EXTERNAL_ID
    LIMIT 1;

    -- IF NO USER IS FOUND, THE INTERNAL ID WILL REMAIN AS 0
    IF P_INTERNAL_ID IS NULL THEN
        SET P_INTERNAL_ID = 0;
    END IF;
END $$

DELIMITER ;
